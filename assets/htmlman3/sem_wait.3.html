<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

  <title>sem_wait(3) — Linux manual pages</title>
  <link rel="stylesheet" type="text/css" href="../stylesheet/manpages.css" />
  
  <link rel="home" href="../index.html" title="sem_wait(3) — Linux manual pages" />
  <script type="text/javascript" src="../stylesheet/manpages.js" xml:space="preserve">
</script>
  <link rel="icon" href="../stylesheet/icon.gif" type="image/gif" />
</head>

<body onload="javascript:init()">
  <div class="navheader">
    <table width="100%">
      <tbody>
        <tr>
          <td style="width: 33%" rowspan="1" colspan="1"><a href="../index.html" shape="rect">Linux
          manual pages</a></td>

          <th rowspan="1" colspan="1"><a href="../index3.html" shape="rect">Section 3</a></th>

          <td style="width: 33%" rowspan="1" colspan="1"> </td>
        </tr>
      </tbody>
    </table>
    <hr />
  </div>

  <div class="refentry" title="sem_wait(3) — Linux manual pages">
    <a id="sem-wait.3" name="sem-wait.3" shape="rect"> </a>

    <div class="titlepage"> </div>

    <div class="refnamediv">
      <h2>Name</h2>

      <p>sem_wait, sem_timedwait, sem_trywait — lock a
      semaphore</p>
    </div>

    <div class="refsynopsisdiv" title="Synopsis">
      <h2>Synopsis</h2>

      <div class="funcsynopsis">
        <pre class="funcsynopsisinfo" xml:space="preserve">
#include &lt;semaphore.h&gt;
</pre>

        <table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">int
            <strong>sem_wait</strong>(</code></td>

            <td rowspan="1" colspan="1">sem_t *<var class="pdparam">sem</var><code>)</code>;</td>
          </tr>
        </table>

        <div class="funcprototype-spacer">
           
        </div>
      </div>

      <div class="funcsynopsis">
        <table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">int
            <strong>sem_trywait</strong>(</code></td>

            <td rowspan="1" colspan="1">sem_t *<var class="pdparam">sem</var><code>)</code>;</td>
          </tr>
        </table>

        <div class="funcprototype-spacer">
           
        </div>
      </div>

      <div class="funcsynopsis">
        <table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">int
            <strong>sem_timedwait</strong>(</code></td>

            <td rowspan="1" colspan="1">sem_t *<var class="pdparam">sem</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">const struct timespec *<var class="pdparam">abs_timeout</var><code>)</code>;</td>
          </tr>
        </table>

        <div class="funcprototype-spacer">
           
        </div>
      </div>

      <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
        <table border="0" summary="Note">
          <tr>
            <td rowspan="2" align="center" valign="top" width="25" colspan="1">
            <img alt="[Note]" src="../stylesheet/note.png" /></td>

            <th align="left" rowspan="1" colspan="1">Note</th>
          </tr>

          <tr>
            <td align="left" valign="top" rowspan="1" colspan="1">
              <div class="featuretests">
                <table style="border-collapse: collapse;">
                  <colgroup span="1">
                    <col span="1" />
                  </colgroup>

                  <thead>
                    <tr>
                      <th style="" rowspan="1" colspan="1">Feature Test Macro Requirements
                      for glibc (see <a class="link" href="../htmlman7/feature_test_macros.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">feature_test_macros</span>(7)</span></a>):</th>
                    </tr>
                  </thead>

                  <tbody>
                    <tr>
                      <td style="" rowspan="1" colspan="1"><code class="function">sem_timedwait</code>():</td>
                    </tr>

                    <tr>
                      <td class="featuretestdef" style="" rowspan="1" colspan="1">
                      <code class="constant">_POSIX_C_SOURCE</code>
                      &gt;= 200112L || <code class="constant">_XOPEN_SOURCE</code> &gt;=
                      600</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </td>
          </tr>
        </table>
      </div>

      <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
        <table border="0" summary="Note">
          <tr>
            <td rowspan="2" align="center" valign="top" width="25" colspan="1">
            <img alt="[Note]" src="../stylesheet/note.png" /></td>

            <th align="left" rowspan="1" colspan="1">Note</th>
          </tr>

          <tr>
            <td align="left" valign="top" rowspan="1" colspan="1">
              <p>Link with <code class="option">−pthread</code>.</p>
            </td>
          </tr>
        </table>
      </div>
    </div>

    <div class="refsect1" title="DESCRIPTION">
      <a id="sem-wait-3_sect1" name="sem-wait-3_sect1" shape="rect"> </a>

      <h2>DESCRIPTION</h2>

      <p><code class="function">sem_wait</code>() decrements
      (locks) the semaphore pointed to by <em class="parameter"><code>sem</code></em>. If the semaphore's value
      is greater than zero, then the decrement proceeds, and the
      function returns, immediately. If the semaphore currently has
      the value zero, then the call blocks until either it becomes
      possible to perform the decrement (i.e., the semaphore value
      rises above zero), or a signal handler interrupts the
      call.</p>

      <p><code class="function">sem_trywait</code>() is the same as
      <code class="function">sem_wait</code>(), except that if the
      decrement cannot be immediately performed, then call returns
      an error (<code class="varname">errno</code> set to
      <span class="errorname">EAGAIN</span>) instead of
      blocking.</p>

      <p><code class="function">sem_timedwait</code>() is the same
      as <code class="function">sem_wait</code>(), except that
      <em class="parameter"><code>abs_timeout</code></em> specifies
      a limit on the amount of time that the call should block if
      the decrement cannot be immediately performed. The <em class="parameter"><code>abs_timeout</code></em> argument points to
      a structure that specifies an absolute timeout in seconds and
      nanoseconds since the Epoch, 1970-01-01 00:00:00 +0000 (UTC).
      This structure is defined as follows:</p>

      <div class="blockquote">
        <blockquote class="blockquote">
          <div class="structdef">
            <table style="border-collapse: collapse;">
              <colgroup span="1">
                <col class="c1" span="1" />
                <col class="c2" span="1" />
                <col class="c3" span="1" />
                <col class="c4" span="1" />
                <col class="c5" span="1" />
              </colgroup>

              <tbody>
                <tr>
                  <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">
                  struct</td>

                  <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1"><span class="structname">timespec</span> {</td>
                </tr>

                <tr>
                  <td style="" rowspan="1" colspan="1"> </td>

                  <td style="" align="left" rowspan="1" colspan="1"><span class="type">time_t</span></td>

                  <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                   </td>

                  <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>tv_sec</code></em>;</td>

                  <td style="" align="left" rowspan="1" colspan="1">
                    <div class="literallayout">
                      /* Seconds */
                    </div>
                  </td>
                </tr>

                <tr>
                  <td style="" rowspan="1" colspan="1"> </td>

                  <td style="" align="left" rowspan="1" colspan="1"><span class="type">long</span></td>

                  <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                   </td>

                  <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>tv_nsec</code></em>;</td>

                  <td style="" align="left" rowspan="1" colspan="1">
                    <div class="literallayout">
                      
                      /* Nanoseconds [0 .. 999999999] */
                    </div>
                  </td>
                </tr>

                <tr>
                  <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">};</td>
                </tr>
              </tbody>
            </table>
          </div>
        </blockquote>
      </div>

      <p>If the timeout has already expired by the time of the
      call, and the semaphore could not be locked immediately, then
      <code class="function">sem_timedwait</code>() fails with a
      timeout error (<code class="varname">errno</code> set to
      <span class="errorname">ETIMEDOUT</span>).</p>

      <p>If the operation can be performed immediately, then
      <code class="function">sem_timedwait</code>() never fails
      with a timeout error, regardless of the value of <em class="parameter"><code>abs_timeout</code></em>. Furthermore, the
      validity of <em class="parameter"><code>abs_timeout</code></em> is not checked in
      this case.</p>
    </div>

    <div class="refsect1" title="RETURN VALUE">
      <a id="sem-wait-3_sect2" name="sem-wait-3_sect2" shape="rect"> </a>

      <h2>RETURN VALUE</h2>

      <p>All of these functions return 0 on success; on error, the
      value of the semaphore is left unchanged, −1 is
      returned, and <code class="varname">errno</code> is set to
      indicate the error.</p>
    </div>

    <div class="refsect1" title="ERRORS">
      <a id="sem-wait-3_sect3" name="sem-wait-3_sect3" shape="rect"> </a>

      <h2>ERRORS</h2>

      <div class="variablelist">
        <dl>
          <dt><span class="term"><span class="errorname">EINTR</span></span></dt>

          <dd>
            <p>The call was interrupted by a signal handler; see
            <a class="link" href="../htmlman7/signal.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">signal</span>(7)</span></a>.</p>
          </dd>

          <dt><span class="term"><span class="errorname">EINVAL</span></span></dt>

          <dd>
            <p><em class="parameter"><code>sem</code></em> is not a
            valid semaphore.</p>
          </dd>
        </dl>
      </div>

      <p>The following additional error can occur for <code class="function">sem_trywait</code>():</p>

      <div class="variablelist">
        <dl>
          <dt><span class="term"><span class="errorname">EAGAIN</span></span></dt>

          <dd>
            <p>The operation could not be performed without
            blocking (i.e., the semaphore currently has the value
            zero).</p>
          </dd>
        </dl>
      </div>

      <p>The following additional errors can occur for <code class="function">sem_timedwait</code>():</p>

      <div class="variablelist">
        <dl>
          <dt><span class="term"><span class="errorname">EINVAL</span></span></dt>

          <dd>
            <p>The value of <em class="replaceable"><code>abs_timeout.tv_nsecs</code></em> is
            less than 0, or greater than or equal to 1000
            million.</p>
          </dd>

          <dt><span class="term"><span class="errorname">ETIMEDOUT</span></span></dt>

          <dd>
            <p>The call timed out before the semaphore could be
            locked.</p>
          </dd>
        </dl>
      </div>
    </div>

    <div class="refsect1" title="CONFORMING TO">
      <a id="sem-wait-3_sect4" name="sem-wait-3_sect4" shape="rect"> </a>

      <h2>CONFORMING TO</h2>

      <p>POSIX.1-2001.</p>
    </div>

    <div class="refsect1" title="NOTES">
      <a id="sem-wait-3_sect5" name="sem-wait-3_sect5" shape="rect"> </a>

      <h2>NOTES</h2>

      <p>A signal handler always interrupts a blocked call to one
      of these functions, regardless of the use of the <a class="link" href="../htmlman2/sigaction.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">sigaction</span>(2)</span></a> <code class="constant">SA_RESTART</code> flag.</p>
    </div>

    <div class="refsect1" title="EXAMPLE">
      <a id="sem-wait-3_sect6" name="sem-wait-3_sect6" shape="rect"> </a>

      <h2>EXAMPLE</h2>

      <p>The (somewhat trivial) program shown below operates on an
      unnamed semaphore. The program expects two command-line
      arguments. The first argument specifies a seconds value that
      is used to set an alarm timer to generate a <code class="constant">SIGALRM</code> signal. This handler performs a
      <a class="link" href="../htmlman3/sem_post.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">sem_post</span>(3)</span></a> to increment
      the semaphore that is being waited on in <code class="function">main</code>() using <code class="function">sem_timedwait</code>(). The second command-line
      argument specifies the length of the timeout, in seconds, for
      <code class="function">sem_timedwait</code>(). The following
      shows what happens on two different runs of the program:</p>

      <div class="blockquote">
        <blockquote class="blockquote">
          <div class="informalexample">
            <pre class="programlisting" xml:space="preserve">
$<span class="emphasis"><em> ./a.out 2 3</em></span>
About to call sem_timedwait()
sem_post() from handler
sem_timedwait() succeeded
$<span class="emphasis"><em> ./a.out 2 1</em></span>
About to call sem_timedwait()
sem_timedwait() timed out
</pre>
          </div>
        </blockquote>
      </div>

      <div class="refsect2" title="Program source">
        <a id="sem-wait-3_sect7" name="sem-wait-3_sect7" shape="rect"> </a>

        <h3>Program source</h3>

        <div class="informalexample">
          <pre class="programlisting" xml:space="preserve">
#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;semaphore.h&gt;
#include &lt;time.h&gt;
#include &lt;assert.h&gt;
#include &lt;errno.h&gt;
#include &lt;signal.h&gt;

sem_t sem;

#define handle_error(msg) \
    do { perror(msg); exit(EXIT_FAILURE); } while (0)

static void
handler(int sig)
{
    write(STDOUT_FILENO, "sem_post() from handler\n", 24);
    if (sem_post(&amp;sem) == −1) {
        write(STDERR_FILENO, "sem_post() failed\n", 18);
        _exit(EXIT_FAILURE);
    }
}

int
main(int argc, char *argv[])
{
    struct sigaction sa;
    struct timespec ts;
    int s;

    if (argc != 3) {
        fprintf(stderr, "Usage: %s &lt;alarm−secs&gt; &lt;wait−secs&gt;\n",
                argv[0]);
        exit(EXIT_FAILURE);
    }

    if (sem_init(&amp;sem, 0, 0) == −1)
        handle_error("sem_init");

    /* Establish SIGALRM handler; set alarm timer using argv[1] */

    sa.sa_handler = handler;
    sigemptyset(&amp;sa.sa_mask);
    sa.sa_flags = 0;
    if (sigaction(SIGALRM, &amp;sa, NULL) == −1)
        handle_error("sigaction");

    alarm(atoi(argv[1]));

    /* Calculate relative interval as current time plus
       number of seconds given argv[2] */

    if (clock_gettime(CLOCK_REALTIME, &amp;ts) == −1)
        handle_error("clock_gettime");

    ts.tv_sec += atoi(argv[2]);

    printf("main() about to call sem_timedwait()\n");
    while ((s = sem_timedwait(&amp;sem, &amp;ts)) == −1 &amp;&amp; errno == EINTR)
        continue;       /* Restart if interrupted by handler */

    /* Check what happened */

    if (s == −1) {
        if (errno == ETIMEDOUT)
            printf("sem_timedwait() timed out\n");
        else
            perror("sem_timedwait");
    } else
        printf("sem_timedwait() succeeded\n");

    exit((s == 0) ? EXIT_SUCCESS : EXIT_FAILURE);
}
</pre>
        </div>
      </div>
    </div>

    <div class="refsect1" title="SEE ALSO">
      <a id="sem-wait-3_sect8" name="sem-wait-3_sect8" shape="rect"> </a>

      <h2>SEE ALSO</h2>

      <p><a class="link" href="../htmlman2/clock_getres.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">clock_gettime</span>(2)</span></a>, <a class="link" href="../htmlman3/sem_getvalue.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">sem_getvalue</span>(3)</span></a>, <a class="link" href="../htmlman3/sem_post.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">sem_post</span>(3)</span></a>, <a class="link" href="../htmlman7/sem_overview.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">sem_overview</span>(7)</span></a>, <a class="link" href="../htmlman7/time.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">time</span>(7)</span></a></p>
    </div>

    <div class="colophon" title="COLOPHON">
      <a id="sem-wait-3_sect9" name="sem-wait-3_sect9" shape="rect"> </a>

      <h2>COLOPHON</h2>

      <p>This page is part of release 3.42 of the Linux <em class="replaceable"><code>man-pages</code></em> project. A
      description of the project, and information about reporting
      bugs, can be found at
      http://www.kernel.org/doc/man-pages/.</p>

      <div class="license">
        <table style="border-collapse: collapse;">
          <colgroup span="1">
            <col span="1" />
          </colgroup>

          <tbody>
            <tr>
              <td style="" rowspan="1" colspan="1">
                <div class="literallayout">
                  <br />
                    t<br />
                  <br />
                  Copyright (C) 2006 Michael Kerrisk &lt;mtk.manpages<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>gmail.com&gt;<br />

                  <br />
                  Permission is granted to make and distribute verbatim copies of this<br />

                  manual provided the copyright notice and this permission notice are<br />

                  preserved on all copies.<br />
                  <br />
                  Permission is granted to copy and distribute modified versions of this<br />

                  manual under the conditions for verbatim copying, provided that the<br />

                  entire resulting derived work is distributed under the terms of a<br />

                  permission notice identical to this one.<br />

                  <br />
                  Since the Linux kernel and libraries are constantly changing, this<br />

                  manual page may be incorrect or out-of-date.  The author(s) assume no<br />

                  responsibility for errors or omissions, or for damages resulting from<br />

                  the use of the information contained herein.  The author(s) may not<br />

                  have taken the same level of care in the production of this manual,<br />

                  which is licensed free of charge, as they might when working<br />

                  professionally.<br />
                  <br />
                  Formatted or processed versions of this manual, if unaccompanied by<br />

                  the source, must acknowledge the copyright and authors of this work.<br />
                  
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</body>
</html>
